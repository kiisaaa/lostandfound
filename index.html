<script>
  const form = document.getElementById('reportForm');
  const reportList = document.getElementById('reportList');
  const button = form.querySelector("button[type='submit']");

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    // ðŸ”’ Disable button agad para hindi ma-double click
    button.disabled = true;
    button.innerText = "Sending...";

    const formData = new FormData(form);

    try {
      const response = await fetch('https://lostandfound-cwod.onrender.com/send-report', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();
      if (result.success) {
        alert("Report sent successfully!");
      } else {
        alert("Failed to send report: " + result.message);
      }
    } catch (err) {
      alert("Error connecting to server: " + err.message);
    }

    // Format datetime
    let formattedDateTime = form.time.value;
    if (formattedDateTime) {
      const dateObj = new Date(form.time.value);
      const options = {
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "numeric",
        minute: "2-digit",
        hour12: true
      };
      formattedDateTime = dateObj.toLocaleString(undefined, options);
    }

    // Display locally too
    const reportItem = document.createElement('div');
    reportItem.classList.add('report-item');
    reportItem.innerHTML = `
      <p><strong>Founder:</strong> ${form.founder.value}</p>
      <p><strong>Place Searched:</strong> ${form.place.value}</p>
      <p><strong>Time Lost:</strong> ${formattedDateTime}</p>
      <p><strong>Description:</strong> ${form.description.value}</p>
    `;

    // Preview uploaded image if exists
    if (form.image.files[0]) {
      const img = document.createElement('img');
      img.src = URL.createObjectURL(form.image.files[0]);
      reportItem.appendChild(img);
    }

    reportList.appendChild(reportItem);
    form.reset();

    // âœ… Re-enable button after submit finishes
    button.disabled = false;
    button.innerText = "Submit Report";
  });
</script>
